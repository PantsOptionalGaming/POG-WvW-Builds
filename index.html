<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GW2 Builds Viewer</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; max-width: 900px; margin: auto; }
  button { margin: 5px; padding: 8px 12px; cursor: pointer; }
  #loading { display: none; color: #0066cc; margin-top: 10px; }
  table { border-collapse: collapse; margin-top: 15px; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
  th { background-color: #eee; }
</style>
</head>
<body>

<h1>Guild Wars 2 Builds</h1>

<div>
  <strong>Professions:</strong>
  <button onclick="loadBuilds('profession', 'Elementalist')">Elementalist</button>
  <button onclick="loadBuilds('profession', 'Engineer')">Engineer</button>
  <button onclick="loadBuilds('profession', 'Guardian')">Guardian</button>
  <button onclick="loadBuilds('profession', 'Mesmer')">Mesmer</button>
  <button onclick="loadBuilds('profession', 'Necromancer')">Necromancer</button>
  <button onclick="loadBuilds('profession', 'Ranger')">Ranger</button>
  <button onclick="loadBuilds('profession', 'Revenant')">Revenant</button>
  <button onclick="loadBuilds('profession', 'Thief')">Thief</button>
  <button onclick="loadBuilds('profession', 'Warrior')">Warrior</button>
</div>

<div style="margin-top:15px;">
  <strong>Roles:</strong>
  <button onclick="loadBuilds('role', 'Support')">Support</button>
  <button onclick="loadBuilds('role', 'Utility Support')">Utility Support</button>
  <button onclick="loadBuilds('role', 'FrontLineDPS')">FrontLine DPS</button>
  <button onclick="loadBuilds('role', 'BackLineDPS')">BackLine DPS</button>
  <button onclick="loadBuilds('role', 'BoonStrip')">Boon Strip</button>
</div>

<div id="loading">Loading builds...</div>

<table id="build-table"></table>

<script>
  // IMPORTANT: Replace this URL with your Builds Sheet web app URL (backend)
  const scriptURL = "https://script.google.com/macros/s/AKfycbwAP2IrzRJtHMsJOu-xCLBLhlXrNR1tvRM76-Z_lw8yUkbnus4z-qtryeegcO6OEtmT/exec";

  function loadBuilds(type, value) {
    const loading = document.getElementById('loading');
    const table = document.getElementById('build-table');
    loading.style.display = 'block';
    table.innerHTML = '';

    // JSONP callback function name
    const callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());

    // Define the callback function globally
    window[callbackName] = function(data) {
      delete window[callbackName]; // Clean up
      loading.style.display = 'none';

      if (!data || !data.length) {
        table.innerHTML = '<tr><td>No builds found.</td></tr>';
        return;
      }

      const headers = data[0];
      const rows = data.slice(1);

      let html = '<tr>' + headers.map(h => `<th>${h}</th>`).join('') + '</tr>';
      rows.forEach(row => {
        html += '<tr>' + row.map(cell => {
          if (typeof cell === 'string' && cell.startsWith('http')) {
            return `<td><a href="${cell}" target="_blank" rel="noopener noreferrer">Link</a></td>`;
          }
          return `<td>${cell}</td>`;
        }).join('') + '</tr>';
      });

      table.innerHTML = html;
    };

    // Create script tag for JSONP request
    const script = document.createElement('script');
    script.src = `${scriptURL}?filterType=${type}&filterValue=${encodeURIComponent(value)}&callback=${callbackName}`;
    script.onerror = function() {
      loading.style.display = 'none';
      table.innerHTML = '<tr><td>Error loading builds.</td></tr>';
    };
    document.body.appendChild(script);
  }
</script>

</body>
</html>
